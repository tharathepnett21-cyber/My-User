<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Users = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Award = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="8" r="7"></circle>
                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
            </svg>
        );

        const Star = ({ size = 24, fill = "none" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        );

        const Shield = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
        );

        const TrendingUp = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Calendar = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const RefreshCw = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );

        function AdminDashboard() {
            const [members, setMembers] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadMembers();
            }, []);

            const loadMembers = () => {
                setLoading(true);
                try {
                    const stored = localStorage.getItem('members');
                    if (stored) {
                        const loadedMembers = JSON.parse(stored);
                        setMembers(loadedMembers.sort((a, b) => b.points - a.points));
                    }
                } catch (error) {
                    console.log('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
                }
                setLoading(false);
            };

            const saveMembers = (membersData) => {
                localStorage.setItem('members', JSON.stringify(membersData));
            };

            const handleDelete = (id) => {
                if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    const updatedMembers = members.filter(m => m.id !== id);
                    setMembers(updatedMembers);
                    saveMembers(updatedMembers);
                }
            };

            const exportData = () => {
                const csvContent = [
                    ['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏ä‡∏∑‡πà‡∏≠', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', '‡πÅ‡∏ï‡πâ‡∏°', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£', '‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î'],
                    ...members.map((m, i) => [
                        i + 1,
                        m.name,
                        m.phone,
                        m.points,
                        m.visitCount,
                        new Date(m.registeredAt).toLocaleString('th-TH'),
                        new Date(m.lastVisit).toLocaleString('th-TH')
                    ])
                ].map(row => row.join(',')).join('\n');

                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `members_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
            };

            const formatDate = (isoString) => {
                const date = new Date(isoString);
                return date.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const getMedalColor = (index) => {
                if (index === 0) return 'bg-yellow-400 text-yellow-900';
                if (index === 1) return 'bg-gray-300 text-gray-700';
                if (index === 2) return 'bg-orange-400 text-orange-900';
                return 'bg-blue-100 text-blue-700';
            };

            const totalPoints = members.reduce((sum, m) => sum + m.points, 0);
            const totalVisits = members.reduce((sum, m) => sum + m.visitCount, 0);
            const avgPointsPerMember = members.length > 0 ? (totalPoints / members.length).toFixed(1) : 0;
            const topMember = members.length > 0 ? members[0] : null;

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-100 flex items-center justify-center">
                        <div className="text-gray-600 text-xl">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-100 py-8 px-4">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="flex justify-between items-center mb-8">
                            <div className="flex items-center gap-3">
                                <Shield className="text-blue-600" size={48} />
                                <div>
                                    <h1 className="text-4xl font-bold text-gray-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h1>
                                    <p className="text-gray-600 mt-1">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
                                </div>
                            </div>
                            <button
                                onClick={loadMembers}
                                className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-3 rounded-lg transition shadow-lg"
                            >
                                <RefreshCw size={20} />
                                ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                        </div>

                        {/* Top Member */}
                        {topMember && (
                            <div className="bg-gradient-to-r from-yellow-100 to-orange-100 rounded-xl shadow-lg p-6 border-2 border-yellow-400 mb-8">
                                <div className="flex items-center gap-3 mb-4">
                                    <Award className="text-yellow-600" size={36} />
                                    <h2 className="text-2xl font-bold text-gray-800">üèÜ ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°</h2>
                                </div>
                                <div className="flex items-center justify-between flex-wrap gap-4">
                                    <div>
                                        <p className="text-3xl font-bold text-gray-800 mb-1">{topMember.name}</p>
                                        <p className="text-gray-600 text-lg">üì± {topMember.phone}</p>
                                        <p className="text-gray-500 text-sm mt-2">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠: {formatDate(topMember.registeredAt)}</p>
                                    </div>
                                    <div className="text-right">
                                        <div className="flex items-center gap-2 text-yellow-700 font-bold text-3xl mb-2">
                                            <Star size={32} fill="currentColor" />
                                            {topMember.points} ‡πÅ‡∏ï‡πâ‡∏°
                                        </div>
                                        <p className="text-gray-600 text-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ {topMember.visitCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Export Button */}
                        <div className="flex justify-end mb-6">
                            <button
                                onClick={exportData}
                                disabled={members.length === 0}
                                className="flex items-center gap-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold px-6 py-3 rounded-lg transition shadow-lg"
                            >
                                <Download size={20} />
                                ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV
                            </button>
                        </div>

                        {/* Members Table */}
                        <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                            <div className="bg-gradient-to-r from-blue-600 to-blue-700 p-6">
                                <div className="flex items-center gap-3">
                                    <Users className="text-white" size={32} />
                                    <h2 className="text-2xl font-semibold text-white">
                                        ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({members.length} ‡∏Ñ‡∏ô)
                                    </h2>
                                </div>
                            </div>

                            <div className="p-6">
                                {members.length === 0 ? (
                                    <div className="text-center py-16 text-gray-400">
                                        <Users size={64} className="mx-auto mb-4 opacity-30" />
                                        <p className="text-xl font-medium">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
                                        <p className="text-sm mt-2">‡∏£‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</p>
                                    </div>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead className="bg-gray-50 border-b-2 border-gray-200">
                                                <tr>
                                                    <th className="px-6 py-4 text-left text-sm font-bold text-gray-700">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                                    <th className="px-6 py-4 text-left text-sm font-bold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                                    <th className="px-6 py-4 text-left text-sm font-bold text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                                    <th className="px-6 py-4 text-center text-sm font-bold text-gray-700">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°</th>
                                                    <th className="px-6 py-4 text-center text-sm font-bold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th>
                                                    <th className="px-6 py-4 text-left text-sm font-bold text-gray-700">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                                    <th className="px-6 py-4 text-center text-sm font-bold text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {members.map((member, index) => (
                                                    <tr key={member.id} className="border-b border-gray-100 hover:bg-blue-50 transition-colors">
                                                        <td className="px-6 py-4">
                                                            <span className={`${getMedalColor(index)} font-bold px-4 py-2 rounded-full text-sm inline-block min-w-16 text-center`}>
                                                                #{index + 1}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <p className="font-semibold text-gray-800 text-base">{member.name}</p>
                                                        </td>
                                                        <td className="px-6 py-4 text-gray-600 font-medium">{member.phone}</td>
                                                        <td className="px-6 py-4">
                                                            <div className="flex items-center justify-center gap-2 bg-purple-100 text-purple-700 font-bold py-2 px-4 rounded-lg">
                                                                <Star size={18} fill="currentColor" />
                                                                <span className="text-lg">{member.points}</span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-center">
                                                            <span className="bg-green-100 text-green-700 font-bold py-2 px-4 rounded-lg inline-block">
                                                                {member.visitCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-4 text-gray-600">{formatDate(member.lastVisit)}</td>
                                                        <td className="px-6 py-4 text-center">
                                                            <button
                                                                onClick={() => handleDelete(member.id)}
                                                                className="bg-red-500 hover:bg-red-600 text-white p-3 rounded-lg transition shadow-md hover:shadow-lg"
                                                                title="‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å"
                                                            >
                                                                <Trash2 size={18} />
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminDashboard />);
    </script>
</body>
</html>
